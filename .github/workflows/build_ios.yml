name: Flutter iOS Build

# Controls when the workflow will run
on:
  push:
    branches: [ "main", "master" ]
    paths:
      - '**.dart'
      - 'pubspec.yaml'
      - 'pubspec.lock'
      - '.github/workflows/build_ios.yml'
  pull_request:
    branches: [ "main", "master" ]
    paths:
      - '**.dart'
      - 'pubspec.yaml'
      - 'pubspec.lock'
      - '.github/workflows/build_ios.yml'
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build_ios:
    # The type of runner that the job will run on
    runs-on: macos-latest # macOS is required for iOS builds

    steps:
      # 1. Checks-out your repository under $GITHUB_WORKSPACE, so the job can access it
      - uses: actions/checkout@v4

      # 2. Setup the Flutter environment
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          # Using a stable version compatible with your Dart SDK ^3.9.2
          flutter-version: '3.35.7' 
          channel: 'stable'
          cache: true

      # 3. Get dependencies
      - name: Get Flutter dependencies
        run: flutter pub get

      # 4. Enable support for iOS (usually not strictly necessary if project is already set up)
      # - name: Enable iOS platform (optional)
      #   run: flutter config --enable-ios

      # 5. Build the iOS application (IPA)
      - name: Build Flutter iOS (Release)
        run: flutter build ipa --release
        # Optional: Specify a target simulator for testing if not building IPA
        # run: flutter build ios --simulator

      # 6. Archive the build output (the IPA file)
      - name: Archive Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ios-build-ipa # Name of the artifact
          # The IPA is located in build/ios/ipa/
          path: build/ios/ipa/*.ipa 
          retention-days: 5
